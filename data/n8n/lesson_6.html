<h1>Настройка окружения</h1>

<p>Правильная настройка окружения критична для эффективной работы с n8n, особенно при разработке мультиагентных систем.</p>

<h2>1. Структура проекта</h2>

<p>Рекомендуемая структура для работы с n8n:</p>

<pre><code>n8n-project/
├── workflows/          # Экспортированные workflow
├── credentials/        # Учетные данные (в безопасном хранилище)
├── scripts/           # Вспомогательные скрипты
├── docs/              # Документация
└── docker-compose.yml # Конфигурация Docker
</code></pre>

<h2>2. Переменные окружения для разработки</h2>

<p>Создайте файл <code>.env</code> для локальной разработки:</p>

<pre><code># Режим разработки
N8N_ENV=development
N8N_LOG_LEVEL=debug

# Базовые настройки
N8N_HOST=localhost
N8N_PORT=5678
N8N_PROTOCOL=http

# Безопасность (для разработки можно отключить)
N8N_BASIC_AUTH_ACTIVE=false

# Хранение данных
N8N_USER_FOLDER=/home/node/.n8n

# Выполнение workflow
EXECUTIONS_PROCESS=main
EXECUTIONS_DATA_SAVE_ON_ERROR=all
EXECUTIONS_DATA_SAVE_ON_SUCCESS=all
EXECUTIONS_DATA_MAX_AGE=336

# Webhook
WEBHOOK_URL=http://localhost:5678/
</code></pre>

<h2>3. Настройка для работы с LLM</h2>

<p>Для работы с DeepSeek и другими LLM настройте переменные:</p>

<pre><code># DeepSeek API
DEEPSEEK_API_KEY=your_api_key_here
DEEPSEEK_API_BASE=https://api.deepseek.com

# Другие LLM (опционально)
OPENAI_API_KEY=your_openai_key
ANTHROPIC_API_KEY=your_anthropic_key
</code></pre>

<p><strong>Важно:</strong> Никогда не храните API ключи в коде. Используйте переменные окружения или credential store n8n.</p>

<h2>4. Настройка Credentials в n8n</h2>

<p>n8n имеет встроенную систему управления учетными данными:</p>

<ol>
    <li>Перейдите в Settings → Credentials</li>
    <li>Создайте новые credentials для каждого сервиса</li>
    <li>Используйте переменные окружения для значений</li>
</ol>

<h3>Пример: Credentials для DeepSeek</h3>

<p>При создании HTTP Request ноды:</p>
<ul>
    <li>URL: <code>https://api.deepseek.com/v1/chat/completions</code></li>
    <li>Method: POST</li>
    <li>Authentication: Generic Credential Type</li>
    <li>Header: <code>Authorization: Bearer {{ $env.DEEPSEEK_API_KEY }}</code></li>
</ul>

<h2>5. Настройка базы данных (опционально)</h2>

<p>Для production рекомендуется использовать PostgreSQL:</p>

<pre><code># Docker Compose с PostgreSQL
version: '3.8'

services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_DB: n8n
      POSTGRES_USER: n8n
      POSTGRES_PASSWORD: password
    volumes:
      - postgres_data:/var/lib/postgresql/data

  n8n:
    image: n8nio/n8n
    environment:
      DB_TYPE=postgresdb
      DB_POSTGRESDB_HOST=postgres
      DB_POSTGRESDB_DATABASE=n8n
      DB_POSTGRESDB_USER=n8n
      DB_POSTGRESDB_PASSWORD=password
    depends_on:
      - postgres

volumes:
  postgres_data:
</code></pre>

<h2>6. Настройка для мультиагентных систем</h2>

<p>Для работы с несколькими агентами настройте:</p>

<pre><code># Параллельное выполнение
EXECUTIONS_PROCESS=main
N8N_METRICS=true

# Увеличение лимитов для сложных workflow
N8N_EXECUTION_TIMEOUT=3600
N8N_EXECUTION_TIMEOUT_MAX=7200
</code></pre>

<h2>7. Инструменты разработки</h2>

<h3>Экспорт и импорт workflow</h3>

<p>Используйте экспорт для версионирования:</p>
<ul>
    <li>Экспортируйте workflow в JSON</li>
    <li>Храните в системе контроля версий (Git)</li>
    <li>Используйте для развертывания на разных окружениях</li>
</ul>

<h3>Тестирование</h3>

<p>Настройте тестовое окружение:</p>
<pre><code># Тестовые credentials
N8N_ENV=test
DEEPSEEK_API_KEY=test_key
</code></pre>

<h2>8. Мониторинг и логирование</h2>

<pre><code># Включение метрик
N8N_METRICS=true

# Уровни логирования
N8N_LOG_LEVEL=info  # или debug для разработки

# Сохранение всех выполнений
EXECUTIONS_DATA_SAVE_ON_ERROR=all
EXECUTIONS_DATA_SAVE_ON_SUCCESS=all
</code></pre>

<h2>9. Безопасность</h2>

<p>Для production обязательно:</p>
<ul>
    <li>Включите базовую аутентификацию</li>
    <li>Используйте HTTPS</li>
    <li>Настройте firewall</li>
    <li>Регулярно обновляйте n8n</li>
    <li>Используйте сильные пароли</li>
</ul>

<h2>Проверка окружения</h2>

<p>Убедитесь, что все настроено правильно:</p>
<ol>
    <li>n8n запускается без ошибок</li>
    <li>Доступны все необходимые ноды</li>
    <li>Настроены credentials для внешних сервисов</li>
    <li>Переменные окружения загружены</li>
    <li>Можно создавать и тестировать workflow</li>
</ol>

<p>Теперь мы готовы перейти к практической работе с n8n!</p>

