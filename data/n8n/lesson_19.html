<h1>Шаблоны для создания агентов</h1>

<p>Создадим переиспользуемые шаблоны для быстрого создания агентов. Это ускорит прототипирование мультиагентных систем.</p>

<h2>1. Базовый шаблон агента</h2>

<p>Универсальный шаблон для любого агента:</p>

<pre><code>Webhook →
  Set (валидация входных данных) →
  IF (валидны?) →
    ├─ True →
        Set (системный промпт) →
        Set (формирование запроса) →
        HTTP Request (LLM) →
          ├─ Success →
              Code (парсинг ответа) →
              Set (результат)
          └─ Error →
              Set (fallback) →
              Code (логирование)
    └─ False →
        Set (ошибка валидации)
</code></pre>

<h2>2. Шаблон агента-аналитика</h2>

<pre><code>Webhook (data) →
  Set (системный промпт аналитика) →
  Set (формирование промпта анализа) →
  HTTP Request (DeepSeek) →
  Code (извлечение структурированных данных) →
  Set (результат анализа)
</code></pre>

<h3>Системный промпт:</h3>
<pre><code>Ты опытный аналитик данных. Анализируй предоставленные данные и предоставляй:
1. Основные тренды и паттерны
2. Выявленные аномалии
3. Статистические выводы
4. Практические рекомендации

Отвечай структурированно на русском языке.
</code></pre>

<h2>3. Шаблон агента-писателя</h2>

<pre><code>Webhook (topic, style, requirements) →
  Set (системный промпт писателя) →
  Set (формирование промпта) →
  HTTP Request →
  Code (форматирование текста) →
  Set (готовый текст)
</code></pre>

<h3>Системный промпт:</h3>
<pre><code>Ты профессиональный писатель. Создавай качественный контент согласно требованиям:
- Стиль: {{ $json.style }}
- Тема: {{ $json.topic }}
- Требования: {{ $json.requirements }}

Используй живую речь, избегай клише, будь оригинальным.
</code></pre>

<h2>4. Шаблон агента-валидатора</h2>

<pre><code>Webhook (data, rules) →
  Set (системный промпт валидатора) →
  Set (формирование запроса) →
  HTTP Request →
  Code (парсинг результата валидации) →
  Set (результат: valid/invalid + errors)
</code></pre>

<h3>Системный промпт:</h3>
<pre><code>Ты валидатор данных. Проверяй данные на соответствие правилам.

Данные: {{ JSON.stringify($json.data) }}
Правила: {{ JSON.stringify($json.rules) }}

Верни результат в формате JSON:
{
  "valid": true/false,
  "errors": ["список ошибок"],
  "warnings": ["список предупреждений"]
}
</code></pre>

<h2>5. Шаблон агента с контекстом</h2>

<pre><code>Webhook (message, context) →
  Code (объединение контекста) →
  Set (формирование запроса с историей) →
  HTTP Request →
  Code (обновление контекста) →
  Set (ответ + обновленный контекст)
</code></pre>

<h2>6. Шаблон агента с кэшированием</h2>

<pre><code>Webhook →
  Code (хеш входных данных) →
  Code (проверка кэша) →
  IF (есть в кэше?) →
    ├─ True → Set (из кэша)
    └─ False →
        HTTP Request →
        Code (сохранение в кэш) →
        Set (результат)
</code></pre>

<h2>7. Шаблон агента с метриками</h2>

<pre><code>Set (start_time) →
  HTTP Request →
  Set (metrics) →
  Code (логирование метрик) →
  Set (результат + метрики)
</code></pre>

<h3>Метрики:</h3>
<pre><code>{
  "agent": "{{ $json.agent_name }}",
  "execution_time_ms": {{ $now.diff($("Start Time").item.json.start) }},
  "tokens_used": {{ $json.usage.total_tokens }},
  "cost_estimate": {{ $json.usage.total_tokens * 0.0001 }},
  "success": true,
  "timestamp": "{{ $now }}"
}
</code></pre>

<h2>8. Шаблон агента-оркестратора</h2>

<pre><code>Webhook (задача) →
  Code (планирование) →
  Loop (выполнение плана) →
    Execute Workflow (агент) →
    Code (оценка результата) →
    IF (продолжать?) →
      ├─ True → Continue
      └─ False → Break
  → Code (агрегация) →
  Set (финальный результат)
</code></pre>

<h2>9. Шаблон для экспорта/импорта</h2>

<p>Создайте workflow для экспорта шаблона:</p>

<pre><code>Manual Trigger →
  Code (чтение workflow) →
  Set (форматирование) →
  HTTP Request (сохранение в файл)
</code></pre>

<h2>10. Параметризованный шаблон</h2>

<p>Шаблон с настраиваемыми параметрами:</p>

<pre><code>Webhook (config, data) →
  Set (применение конфигурации) →
  Set (системный промпт из config) →
  HTTP Request (параметры из config) →
  Set (результат)
</code></pre>

<h3>Конфигурация:</h3>
<pre><code>{
  "agent_type": "analyst",
  "system_prompt": "Кастомный промпт",
  "temperature": 0.7,
  "max_tokens": 2000,
  "model": "deepseek-chat"
}
</code></pre>

<h2>11. Создание библиотеки шаблонов</h2>

<p>Организуйте шаблоны в структуру:</p>

<pre><code>templates/
├── base-agent.json
├── analyst-agent.json
├── writer-agent.json
├── validator-agent.json
└── orchestrator-agent.json
</code></pre>

<h2>12. Использование шаблонов</h2>

<h3>Импорт шаблона:</h3>
<ol>
    <li>Создайте новый workflow</li>
    <li>Импортируйте JSON шаблона</li>
    <li>Настройте параметры</li>
    <li>Сохраните как новый агент</li>
</ol>

<h2>13. Версионирование шаблонов</h2>

<p>Используйте версии для отслеживания изменений:</p>

<pre><code>{
  "template_version": "1.2.0",
  "template_name": "Base Agent",
  "created": "2025-01-01",
  "updated": "2025-01-15",
  "workflow": {...}
}
</code></pre>

<h2>14. Best Practices</h2>

<ul>
    <li>Создавайте переиспользуемые шаблоны</li>
    <li>Документируйте параметры каждого шаблона</li>
    <li>Используйте версионирование</li>
    <li>Тестируйте шаблоны перед использованием</li>
    <li>Храните шаблоны в системе контроля версий</li>
    <li>Создавайте специализированные шаблоны</li>
    <li>Используйте параметризацию для гибкости</li>
</ul>

<h2>15. Пример использования</h2>

<pre><code>1. Импортируйте шаблон "Base Agent"
2. Настройте системный промпт под вашу задачу
3. Добавьте специфичную логику обработки
4. Протестируйте агента
5. Сохраните как новый агент
6. Используйте в мультиагентной системе
</code></pre>

<p>В следующем уроке мы изучим отладку мультиагентных систем.</p>


